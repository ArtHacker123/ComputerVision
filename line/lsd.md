# Line Segment Detection/线段检测

### 问题

直线检测是一个经典的问题，前面已经有一篇介绍霍夫变换的文章，那么这一篇是介绍了直线检测的另一个方法。

这个方法宣称自己是线性复杂度，因此十分的吸引人，而且另一个证明其效果不错的事情是：它入选了opencv 3.0 beta。每一个入选opencv的算法都多多少少地被人证明了不是个水算法，所以研究一下很有必要。

### 核心思想

霍夫变换的核心思想是空间变换，LSD的核心思想是梯度合并。每一条直线必然会形成一个有相近梯度的像素点群，如果能找到这样的像素点群，那么问题就解决了。

### 步骤

先列出步骤，再详细分析

1. scale down
2. 求梯度
3. 像素合并和候选集生成
4. 候选集过滤

### scale down

之所以先介绍这一部分，是因为它可以算是LSD算法的是一个defect吧，论文上说，LSD算法对于抗锯齿的效果不好，如果图像中有了锯齿线段，那么是有可能检查不出来的，所以第一步是要把图像的长宽各缩小20%，效果立刻不一样了。

这个事情告诉了我，这算法不一定适合大的有锯齿的图像。

### 求梯度

梯度算法直接给出：
```python
def gradient(img, y, x):
  dx = (img[y + 1][x + 1] + img[y][x + 1] - img[y + 1][x] - img[y][x]) / 2
  dy = (img[y + 1][x + 1] + img[y + 1][x] - img[y][x + 1] - img[y][x]) / 2
  return sqrt(dx ^ 2 + dy ^ 2), atan2(dy / dx) # magnitude & angle
```

求得每一点的梯度后，所有的像素点会按照magnitude的大小排降序。代码中提到了一点关于这里的加速算法，时间复杂度可以达到O(n)

### 像素合并和候选集生成



